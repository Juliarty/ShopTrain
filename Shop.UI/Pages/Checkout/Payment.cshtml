@page
@model Shop.UI.Checkout.PaymentModel
@{
}


<div>
    <h3 class="title">Payment</h3>
</div>

<section>
    <div id="app" class="container">
        <vc:cart component-name="Default"></vc:cart>
        <h3 class="subtitle">Total Price</h3>
        <h5 class="subtitle">@Model.CartOrder.TotalChargeStrRubles</h5>

        <form method="post">
            <input type="submit" id="checkout-button" class="button is-success" value="Checkout" />
        </form>
    </div>

</section>

@section scripts
{

    <script src="https://js.stripe.com/v3/"></script>
    <script type="text/javascript">
        // Create an instance of the Stripe object with your publishable API key
        var stripe = Stripe('@Model.PublicKey');
        var checkoutButton = document.getElementById("checkout-button");
        //checkoutButton.addEventListener("click", function () {
        //    fetch("/Checkout/Payment/create-session", {
        //        method: "POST",
        //    })
        //        .then(function (response) {
        //            return response.json();
        //        })
        //        .then(function (session) {
        //            return stripe.redirectToCheckout({ sessionId: session.id });
        //        })
        //        .then(function (result) {
        //            // If redirectToCheckout fails due to a browser or network
        //            // error, you should display the localized error message to your
        //            // customer using error.message.
        //            if (result.error) {
        //                alert(result.error.message);
        //            }
        //        })
        //        .catch(function (error) {
        //            console.error( "Error:", error );
        //        });
        //});

        checkoutButton.addEventListener("click", function () {
            axios.post("/Checkout/Payment")
                .then()
                .catch(error => {
                    console.log("Error:", error);
                });
        });
    </script>
}
